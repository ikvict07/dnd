<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <!-- Effect table -->
    <changeSet id="03-13" author="liquibase">
        <createTable tableName="effect">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="rounds_left" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="effect_template_id" type="bigint">
                <constraints foreignKeyName="fk_effect_effect_template" references="effect_template(id)"/>
            </column>
        </createTable>
        <sql>alter table effect owner to postgres;</sql>
    </changeSet>

    <!-- Potion table -->
    <changeSet id="03-14" author="liquibase">
        <createTable tableName="potion">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(255)"/>
            <column name="cause_effect_id" type="bigint">
                <constraints foreignKeyName="fk_potion_effect_template" references="effect_template(id)"/>
            </column>
            <column name="item_id" type="bigint">
                <constraints foreignKeyName="fk_potion_item" references="item(id)"/>
            </column>
        </createTable>
        <sql>alter table potion owner to postgres;</sql>
        <createIndex indexName="potion_item_id_key" tableName="potion" unique="true">
            <column name="item_id"/>
        </createIndex>
    </changeSet>

    <!-- Combat table -->
    <changeSet id="03-15" author="liquibase">
        <createTable tableName="combat">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="location_id" type="bigint">
                <constraints foreignKeyName="fk_combat_location" references="location(id)"/>
            </column>
        </createTable>
        <sql>alter table combat owner to postgres;</sql>
    </changeSet>

    <!-- Character table -->
    <changeSet id="03-16" author="liquibase">
        <createTable tableName="character">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(255)"/>
            <column name="hp" type="double precision">
                <constraints nullable="false"/>
            </column>
            <column name="lvl" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="xp" type="double precision">
                <constraints nullable="false"/>
            </column>
            <column name="action_points" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="character_class_id" type="bigint">
                <constraints foreignKeyName="fk_character_class" references="class(id)"/>
            </column>
            <column name="inventory_id" type="bigint">
                <constraints foreignKeyName="fk_character_inventory" references="inventory(id)"/>
            </column>
            <column name="location_id" type="bigint">
                <constraints foreignKeyName="fk_character_location" references="location(id)"/>
            </column>
            <column name="weapon_id" type="bigint">
                <constraints foreignKeyName="fk_character_weapon" references="weapon(id)"/>
            </column>
            <column name="armor_set_id" type="bigint">
                <constraints foreignKeyName="fk_character_armor_set" references="armor_set(id)"/>
            </column>
        </createTable>
        <sql>alter table character owner to postgres;</sql>
        <createIndex indexName="character_inventory_id_key" tableName="character" unique="true">
            <column name="inventory_id"/>
        </createIndex>
    </changeSet>

    <!-- Character Attributes table -->
    <changeSet id="03-17" author="liquibase">
        <createTable tableName="character_attributes">
            <column name="character_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_character_attributes_character" references="character(id)"/>
            </column>
            <column name="attributes_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_character_attributes_attribute" references="attribute(id)"/>
            </column>
        </createTable>
        <sql>alter table character_attributes owner to postgres;</sql>
        <createIndex indexName="character_attributes_attributes_id_key" tableName="character_attributes" unique="true">
            <column name="attributes_id"/>
        </createIndex>
    </changeSet>

    <!-- Character Spells table -->
    <changeSet id="03-18" author="liquibase">
        <createTable tableName="character_spells">
            <column name="character_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_character_spells_character" references="character(id)"/>
            </column>
            <column name="spells_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_character_spells_spell" references="spell(id)"/>
            </column>
        </createTable>
        <sql>alter table character_spells owner to postgres;</sql>
    </changeSet>

    <!-- Character Under Effects table -->
    <changeSet id="03-19" author="liquibase">
        <createTable tableName="character_under_effects">
            <column name="character_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_character_under_effects_character" references="character(id)"/>
            </column>
            <column name="under_effects_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_character_under_effects_effect" references="effect(id)"/>
            </column>
        </createTable>
        <sql>alter table character_under_effects owner to postgres;</sql>
        <createIndex indexName="character_under_effects_under_effects_id_key" tableName="character_under_effects" unique="true">
            <column name="under_effects_id"/>
        </createIndex>
    </changeSet>

    <!-- Location Characters table -->
    <changeSet id="03-20" author="liquibase">
        <createTable tableName="location_characters">
            <column name="characters_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_location_characters_character" references="character(id)"/>
            </column>
            <column name="location_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_location_characters_location" references="location(id)"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="location_characters" columnNames="characters_id, location_id"/>
        <sql>alter table location_characters owner to postgres;</sql>
        <createIndex indexName="location_characters_characters_id_key" tableName="location_characters" unique="true">
            <column name="characters_id"/>
        </createIndex>
    </changeSet>

    <!-- Combat Combat Rounds table -->
    <changeSet id="03-21" author="liquibase">
        <createTable tableName="combat_combat_rounds">
            <column name="combat_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_combat_combat_rounds_combat" references="combat(id)"/>
            </column>
            <column name="combat_rounds_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_combat_combat_rounds_round" references="round(id)"/>
            </column>
        </createTable>
        <sql>alter table combat_combat_rounds owner to postgres;</sql>
        <createIndex indexName="combat_combat_rounds_combat_rounds_id_key" tableName="combat_combat_rounds" unique="true">
            <column name="combat_rounds_id"/>
        </createIndex>
    </changeSet>

    <!-- Round Participants table -->
    <changeSet id="03-22" author="liquibase">
        <createTable tableName="round_participants">
            <column name="round_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_round_participants_round" references="round(id)"/>
            </column>
            <column name="participants_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_round_participants_character" references="character(id)"/>
            </column>
        </createTable>
        <sql>alter table round_participants owner to postgres;</sql>
    </changeSet>

    <!-- Combat Log table -->
    <changeSet id="03-23" author="liquibase">
        <createTable tableName="combat_log">
            <column name="id" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="action_points_spent" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="impact" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="actor_id" type="bigint">
                <constraints foreignKeyName="fk_combat_log_actor" references="character(id)"/>
            </column>
            <column name="action_id" type="bigint">
                <constraints foreignKeyName="fk_combat_log_action" references="spell(id)"/>
            </column>
            <column name="target_id" type="bigint">
                <constraints foreignKeyName="fk_combat_log_target" references="character(id)"/>
            </column>
            <column name="caused_effect_id" type="bigint">
                <constraints foreignKeyName="fk_combat_log_effect" references="effect(id)"/>
            </column>
        </createTable>
        <sql>alter table combat_log owner to postgres;</sql>
    </changeSet>

    <!-- Combat Log Items Used table -->
    <changeSet id="03-24" author="liquibase">
        <createTable tableName="combat_log_items_used">
            <column name="combat_log_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_combat_log_items_used_combat_log" references="combat_log(id)"/>
            </column>
            <column name="items_used_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_combat_log_items_used_item" references="item(id)"/>
            </column>
        </createTable>
        <sql>alter table combat_log_items_used owner to postgres;</sql>
        <createIndex indexName="combat_log_items_used_items_used_id_key" tableName="combat_log_items_used" unique="true">
            <column name="items_used_id"/>
        </createIndex>
    </changeSet>

    <!-- Round Logs table -->
    <changeSet id="03-25" author="liquibase">
        <createTable tableName="round_logs">
            <column name="round_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_round_logs_round" references="round(id)"/>
            </column>
            <column name="logs_id" type="bigint">
                <constraints nullable="false" foreignKeyName="fk_round_logs_combat_log" references="combat_log(id)"/>
            </column>
        </createTable>
        <sql>alter table round_logs owner to postgres;</sql>
        <createIndex indexName="round_logs_logs_id_key" tableName="round_logs" unique="true">
            <column name="logs_id"/>
        </createIndex>
    </changeSet>

</databaseChangeLog>